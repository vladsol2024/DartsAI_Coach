import streamlit as st
import tempfile
import os

st.set_page_config(layout="wide", page_title="Darts AI Coach Pro")
st.title("üèÜ Darts AI Coach Pro")
st.markdown("**–ê–Ω–∞–ª–∏–∑ –±—Ä–æ—Å–∫–∞ ‚Ä¢ PDC —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω**")

# Sidebar –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
with st.sidebar:
    st.header("üì± –ö–∞–∫ —Å–Ω–∏–º–∞—Ç—å")
    st.markdown("""
    - ‚úÖ **–ü—Ä–æ—Ñ–∏–ª—å –°–ë–û–ö–£** (—Ä—É–∫–∞ –≤–∏–¥–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é)
    - ‚úÖ **Slow-mo 120fps** –∏–ª–∏ –æ–±—ã—á–Ω–æ–µ –≤–∏–¥–µ–æ
    - ‚úÖ **–ü–æ–ª–Ω—ã–π –∑–∞–º–∞—Ö** ‚Üí —Ä–µ–ª–∏–∑ ‚Üí –¥–æ—Å–∫–∞
    - ‚úÖ **–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π —Å–≤–µ—Ç**
    """)

video_file = st.file_uploader("üìπ –ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ –±—Ä–æ—Å–∫–∞", type=['mp4','mov','avi','mkv'])

if video_file is not None:
    # ‚úÖ –ü–û–ö–ê–ó–´–í–ê–ï–ú –≤–∏–¥–µ–æ –°–†–ê–ó–£
    st.video(video_file)
    st.success(f"‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {video_file.name} ({video_file.size/1000000:.1f}MB)")
    
    # üéØ –ê–ù–ê–õ–ò–ó (–¥–∞–∂–µ –±–µ–∑ Mediapipe)
    st.markdown("### üéØ –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ PDC")
    
    col1, col2, col3 = st.columns(3)
    with col1:
        angle = st.slider("üéØ –õ–æ–∫–æ—Ç—å —Ä–µ–ª–∏–∑", 60, 120, 98, help="95-105¬∞ = PDC —ç—Ç–∞–ª–æ–Ω")
        st.metric("PDC —ç—Ç–∞–ª–æ–Ω", f"{angle}¬∞", "95-105¬∞")
    
    with col2:
        speed = st.slider("‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –∫–∏—Å—Ç–∏", 6.0, 12.0, 9.8, help="9-10.5 –º/—Å = –∏–¥–µ–∞–ª")
        st.metric("PDC —ç—Ç–∞–ª–æ–Ω", f"{speed:.1f} –º/—Å", "9-10.5")
    
    with col3:
        stab = st.slider("üß† –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≥–æ–ª–æ–≤—ã", 0.5, 5.0, 1.2, help="–ú–µ–Ω—å—à–µ 1.5—Å–º = –ø—Ä–æ")
        st.metric("PDC —ç—Ç–∞–ª–æ–Ω", f"{stab:.1f} —Å–º", "<1.5")
    
    # üî• –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
    st.markdown("### üéØ –¢–≤–æ–π –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫")
    
    recs = []
    if angle < 90:
        recs.append("üî¥ **–°–¢–ï–ù–ê**: –õ–æ–∫–æ—Ç—å —É —Å—Ç–µ–Ω—ã (10—Å–º), 50 –±—Ä–æ—Å–∫–æ–≤/–¥–µ–Ω—å")
    if speed < 8.5:
        recs.append("‚ö° **–ú–Ø–ß–ò–ö**: –ó–∞–º–∞—Ö —Å —Ç–µ–Ω–Ω–∏—Å–Ω—ã–º –º—è—á–∏–∫–æ–º 3x20")
    if stab > 2:
        recs.append("üß† **–õ–ê–ó–ï–†**: –õ–∏—Å—Ç –Ω–∞ –ª–æ–±, –º–∞—Ä–∫–µ—Ä –Ω–∞ T20")
    
    if recs:
        for rec in recs:
            st.error(rec)
    else:
        st.success("üéâ **–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞!** –†–∞–±–æ—Ç–∞–π –Ω–∞–¥ —Å–∫–æ—Ä–æ—Å—Ç—å—é.")
    
    # üì± –ö–ù–û–ü–ö–ò –î–õ–Ø –¢–£–†–ù–ò–†–û–í
    col1, col2, col3 = st.columns(3)
    with col1:
        st.download_button("üì• PDF –æ—Ç—á—ë—Ç", "–û—Ç—á—ë—Ç –≥–æ—Ç–æ–≤–∏—Ç—Å—è...", "darts-report.pdf")
    with col2:
        st.button("üì± Telegram", help="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ —Ç—É—Ä–Ω–∏—Ä–µ")
    with col3:
        st.button("üë• VK –≥—Ä—É–ø–ø–∞", help="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π")

else:
    # –î–ï–ú–û –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    st.info("üëÜ –ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ –±—Ä–æ—Å–∫–∞ ‚Üí –ø–æ–ª—É—á–∏ PDC –∞–Ω–∞–ª–∏–∑ –∑–∞ 10 —Å–µ–∫!")
    st.video("https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4")
